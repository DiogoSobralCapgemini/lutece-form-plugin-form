<script>
$(document).ready(function() {
	
	$("#selectAll").change( function() {
    if ( $(this).attr("checked") ){
		// check all
        $("input[name='entry_id']").prop( "checked", "checked");
		} else {
        // uncheck all
        $("input[name='entry_id']").prop( "checked", "");
		}
    });
});
</script>
<#include "/admin/plugins/form/commons.html" />
<div class="row-fluid">
	<div class="span4">
	<form class="form" action="jsp/admin/plugins/form/DoModifyForm.jsp" method="post">
	<fieldset>
	<legend>#i18n{form.modifyForm.title}</legend>
	<input type="hidden" name="id_form" value="${form.idForm}" />		
	<label for="title">#i18n{form.createForm.labelTitle} * :</label>
	<input type="text" name="title" value="${form.title}" class="input-xlarge"  maxlength="255" />
	<p class="help-text">#i18n{form.createForm.labelTitleComment}&nbsp;</p>
	<label for="description">#i18n{form.createForm.labelDescription} * :</label>
	<textarea class="span8" name="description" rows="4">${form.description}</textarea>
	<p class="help-text">#i18n{form.createForm.labelDescriptionComment}</p>
	<label for="category">#i18n{form.createForm.labelCategoryTitle} :</label>
	<#if !form.category?exists>
		<#assign category_default_value="-2" />
	<#else>
		<#assign category_default_value="${form.category.idCategory!}" />
	</#if>
	<@combo name="id_category" items=category_list default_value=category_default_value />
	<p class="help-text">#i18n{form.createForm.labelCategoryComment}</p>
		
	<fieldset>
		<legend id="advanced_settings">
		<i class="icon-chevron-down"></i>&nbsp;#i18n{form.createForm.labelAdvancedSettings}
		</legend>
		<div id="advanced_settings_content">
		<label for="front_office_title">#i18n{form.createForm.frontOfficeTitle}:</label>
		<input type="text" name="front_office_title" value="${form.frontOfficeTitle!}" maxlength="255" />
		<p class="help-text">#i18n{form.createForm.frontOfficeTitleComment}</p>
		<label for="is_shown_front_office_title"#i18n{form.createForm.frontOfficeTitleIsShown}:</label> 
		<input type="checkbox" name="is_shown_front_office_title" value="1" <#if form?exists && form.shownFrontOfficeTitle?exists> checked="checked"</#if> />
		<p class="help-text">#i18n{form.createForm.frontOfficeTitleIsShownComment}</p>
		<label for="workgroup">#i18n{form.createForm.labelWorkgroup} :</label>
		<@combo name="workgroup" items=user_workgroup_list default_value=form.workgroup />
		<p class="help-text">#i18n{form.createForm.labelWorkgroupComment}</p>
		<label for="id_mailing_list">#i18n{form.createForm.labelNotify} :</label>
		<@combo name="id_mailing_list" items=mailing_list default_value=form.idMailingList />
		<p class="help-text">#i18n{form.createForm.labelNotifyComment}</p>
		<#if is_active_captcha>
		<label for="active_captcha">#i18n{form.createForm.labelActiveCaptcha} :</label>
		<input type="checkbox" name="active_captcha" value="1" <#if form?exists && form.activeCaptcha> checked="checked"</#if> />
		<p class="help-text">#i18n{form.createForm.labelActiveCaptchaComment}</p>
		</#if>
		<label for="id_theme_list">#i18n{form.createForm.labelThemeXpage} :</label>
		<@combo name="id_theme_list" items=theme_list default_value=form.codeTheme />
		<label class="checkbox" for="limit_number_response">#i18n{form.createForm.labelLimitNumberResponse} :
		<input type="checkbox" name="limit_number_response" value="1" <#if form?exists && form.limitNumberResponse>checked="checked"</#if> />
		</label>
		<p class="help-text">#i18n{form.createForm.labelLimitNumberResponseComment}</p>
		<label class="checkbox" for="active_store_adresse">#i18n{form.createForm.labelStoreAdresse} :
			<input type="checkbox" name="active_store_adresse" value="1" <#if form?exists && form.activeStoreAdresse>checked="checked"</#if> />
		</label>
		<p class="help-text">#i18n{form.createForm.labelStoreAdresseComment}</p>
		<#if is_active_mylutece_authentification>
		<label for="active_mylutece_authentification">#i18n{form.createForm.labelActiveMyLuteceAuthentification} :</label>
		<input type="checkbox" name="active_mylutece_authentification" value="1" <#if form?exists && form.activeMyLuteceAuthentification>checked="checked"</#if> />
		<p class="help-text">#i18n{form.createForm.labelActiveMyLuteceAuthentificationComment}</p>
		</#if>
		<label class="checkbox" for="active_requirement">#i18n{form.createForm.labelActiveRequirement} :
			<input type="checkbox" name="active_requirement" value="1" <#if form?exists && form.activeRequirement>checked="checked"</#if> />
		</label>
		<p class="help-text">#i18n{form.createForm.labelActiveRequirementComment}</p>
		<label for="information_complementary_1">#i18n{form.createForm.labelInformationComplementary_1}:</label>
		<input type="text" name="information_complementary_1" value="${form.infoComplementary1?if_exists}" class="input-normal" maxlength="255" />
		<label for="information_complementary_2">#i18n{form.createForm.labelInformationComplementary_2} :</label>
		<input type="text" name="information_complementary_2" value="${form.infoComplementary2?if_exists}" class="input-normal" maxlength="255" />
		<label for="information_complementary_3">#i18n{form.createForm.labelInformationComplementary_3} :</label>
		<input type="text" name="information_complementary_3" value="${form.infoComplementary3?if_exists}" class="input-normal" maxlength="255" />
		<label for="information_complementary_4">#i18n{form.createForm.labelInformationComplementary_4} :</label>
		<input type="text" name="information_complementary_4" value="${form.infoComplementary4?if_exists}" class="input-normal" maxlength="255" />
		<label for="information_complementary_5">#i18n{form.createForm.labelInformationComplementary_5} :</label>
		<input type="text" name="information_complementary_5" value="${form.infoComplementary5?if_exists}" class="input-normal" maxlength="255" />
		<p class="help-text">#i18n{form.createForm.labelInformationComplementary_comment}</p>
		<label for="support_https">#i18n{form.createForm.supportHTTPS} :</label>
		<input type="checkbox" name="support_https" value="1" <#if form.supportHTTPS?has_content && form.supportHTTPS>checked="checked"</#if> />
		<p class="help-text">#i18n{form.createForm.labelSupportHTTPS_comment}</p>
		<!-- p class="label label-warning"> #i18n{form.message.warning.advanced_parameters_save}</p -->
		</div>
	</fieldset>	
	<fieldset>
		<legend id="publication_settings"><i class="icon-chevron-down"></i>&nbsp;#i18n{form.createForm.labelPublication}</legend>
		<div id="publication_settings_content">
			<label for="publication_mode">#i18n{form.createForm.labelPublicationMode} :</label>
			<input type="radio" name="publication_mode" id="publication_mode_user" value="0" onclick="javascript:doChangePublicationMode(this.form.publication_mode);"
			<#if !form.dateBeginDisponibility?? && !form.dateEndDisponibility??>checked="checked"</#if>	/> #i18n{form.createForm.labelPublicationModeUser}
			<input type="radio" name="publication_mode" id="publication_mode_auto" value="1" onclick="javascript:doChangePublicationMode(this.form.publication_mode);"
			<#if form.dateBeginDisponibility?? || form.dateEndDisponibility??>checked="checked"</#if> /> #i18n{form.createForm.labelPublicationModeAuto}
			<p class="help-text">#i18n{form.createForm.labelPublicationModeComment}</p>
			<label for="date_begin_disponibility">#i18n{form.createForm.labelDateBeginDisponibility} :</label>
			<div class="input-prepend">
				<span class="add-on"><i class="icon-calendar"></i></span>
				<input type="text" name="date_begin_disponibility" id="date_begin_disponibility" value="${form.dateBeginDisponibility?if_exists}" class="input-small"  onchange="javascript:doChangeDate(this.form.publication_mode);" />
			</div>
			<input type="hidden" name="date_begin_disponibility_save" id="date_begin_disponibility_save" value="${form.dateBeginDisponibility?if_exists}" />
			<p class="help-text">#i18n{form.createForm.labelDateBeginDisponibilityComment}</p>
			<label for="date_end_disponibility">#i18n{form.createForm.labelDateEndDisponibility} :</label>
			<div class="input-prepend">
				<span class="add-on"><i class="icon-calendar"></i></span>
				<input type="text" name="date_end_disponibility" id="date_end_disponibility" value="${form.dateEndDisponibility?if_exists}" class="input-small"  onchange="javascript:doChangeDate(this.form.publication_mode);" />
			</div>
			<input type="hidden" name="date_end_disponibility_save" id="date_end_disponibility_save" value="${form.dateEndDisponibility?if_exists}" />
			<p class="help-text">#i18n{form.createForm.labelDateEndDisponibilityComment}</p>
		</div>
	</fieldset>
	<fieldset>
		<legend id="answers_cleaning_settings"><i class="icon-chevron-down"></i>&nbsp;#i18n{form.modifyForm.labelAnswersRemoval}</legend>
		<div id="answers_cleaning_settings_content" class="form-inline">
			<div class="control-group">
				<label class="control-label" for="automaticCleaning"><input type="checkbox" name="automaticCleaning" value="true" <#if form.automaticCleaning>checked="checked"</#if>>&nbsp;#i18n{form.createForm.labelAutomaticCleaning}</label>
			</div>
			<div class="control-group">
				<label for="cleaningByRemoval">#i18n{form.createForm.labelCleaningMethod} :</label>
				<div class="controls">
					<label for="cleaningByRemoval"><input type="radio" name="cleaningByRemoval" value="true" <#if form.cleaningByRemoval>checked="checked"</#if> >&nbsp;#i18n{form.createForm.labelRemove}</label>
					<label for="cleaningByRemoval"><input type="radio" name="cleaningByRemoval" value="false" <#if !form.cleaningByRemoval>checked="checked"</#if> >&nbsp;#i18n{form.createForm.labelAnonymize}</label>
				</div>
			</div>
			<div class="control-group">
				<label class="control-label" for="nb_days_before_cleaning">#i18n{form.createForm.labelNbDaysBeforeCleaning} :</label>
				<div class="controls">
					<input id="nb_days_before_cleaning" name="nb_days_before_cleaning" value="${form.nbDaysBeforeCleaning!}">
				</div>
			</div>
			<#if 0 < entry_list?size>
				<div class="control-group">
					<label for="anonymizeEntries">#i18n{form.createForm.labelAnonymizeEntries} :</label>
					<div class="controls">
						<#list entry_list as entry>
							<#if !entry.entryType.group>
								<label for="anonymizeEntries"><input type="checkbox" name="anonymizeEntries" value="${entry.idEntry}" <#if anonymize_entry_list?seq_contains(entry.idEntry)>checked="checked"</#if>>&nbsp;${entry.title}<br /></label>
								<#if (entry.fields)?? && 0 < entry.fields?size>
									<#list entry.fields as field>	
										<#if (field.conditionalQuestions)?? && 0 < field.conditionalQuestions?size>
											<#list field.conditionalQuestions as child>
												<#if !child.entryType.group>
													<label for="anonymizeEntries"><input type="checkbox" name="anonymizeEntries" value="${child.idEntry}" <#if anonymize_entry_list?seq_contains(child.idEntry)>checked="checked"</#if>>&nbsp;${child.title}<br /></label>
												</#if>
											</#list>
										</#if>
									</#list>
								</#if>
							</#if>
						</#list>
					</div>
				</div>
			</#if>
		</div>
	</fieldset>
	<div class="form-actions">
		<button type="submit" class="btn btn-primary btn-small" name="save">
			<i class="icon-ok icon-white"></i>&nbsp;#i18n{form.createForm.buttonSave}
		</button>
		<button type="submit" class="btn btn-primary btn-small" name="apply">
			<i class="icon-ok-circle icon-white"></i>&nbsp;#i18n{form.modifyForm.buttonApply}
		</button>
		<button type="submit" class="btn btn-small" name="cancel" onclick="javascript:window.history.back();">
			<i class="icon-remove-circle"></i>&nbsp;#i18n{form.createForm.buttonCancel}
		</button>
	</div>
	</fieldset>	
</form>
</div>
<div id="questions" class="span8">
<a name="list" id="list"></a>
<fieldset>
<legend>#i18n{form.modifyForm.manageEnter.title} </legend>
<form method="post" class="form-inline pull-left spaced" action="jsp/admin/plugins/form/DoCreateEntry.jsp?id_type=${entry_type_group.idType}#list">
<input type="text" name="title" value="" placeholder="#i18n{form.modifyForm.manageEnter.labelInsertGroup}"/>
<button type="submit" class="btn btn-primary btn-small" title="#i18n{form.modifyForm.manageEnter.buttonInsertGroup}"><i class="icon-plus icon-white"></i></button>
</form>
<form method="post" class="form-inline pull-left" action="jsp/admin/plugins/form/CreateEntry.jsp">
<@combo name="id_type" items=entry_type_list default_value=-1 /><button type="submit" class="btn btn-primary btn-small" title="#i18n{form.modifyForm.manageEnter.buttonInsertEntry}"><i class="icon-plus icon-white"></i></button>
</form>
<@paginationAdmin paginator=paginator combo=1/>
<#if entry_group_list?has_content>
<form method="post"	action="jsp/admin/plugins/form/DoChangeOrderEntry.jsp" 	class="form-inline">
<input type="hidden" name="id_form" value="${form.idForm}" />
<!-- List all entry of type group  -->
<@comboWithParams name="id_entry_group" default_value="" additionalParameters="class=\"input-xlarge\"" items=entry_group_list />  
<button type="submit" class="btn btn-small" title="#i18n{form.modifyForm.moveAll}" name="move.x" value="#i18n{form.modifyForm.moveAll}">
	<i class="icon-resize-vertical"></i>
</button>

</#if>
	<table class="table table-striped">
	<thead>
		<tr> 
			<th>
				<input type="checkbox" name="selectAll" id="selectAll" value="selectAll" title="#i18n{form.modifyForm.selectAll}" />
			</th>
			<th>#i18n{form.modifyForm.manageEnter.rowTitle} #i18n{form.modifyForm.manageEnter.rowType}</th>
			<th><i class="icon-question-sign" title="#i18n{form.modifyForm.manageEnter.rowConditionalQuestion}"></i></th>
			<th>#i18n{form.modifyForm.manageEnter.rowOrder}
<!-- 				<a href="jsp/admin/plugins/form/UpdateEntryOrder.jsp?id_form=${form.idForm}&plugin_name=form" class="btn btn-small spaced" title="#i18n{form.modifyForm.initOrder}"> -->
<!-- 					<i class="icon-refresh"></i> -->
<!-- 				</a> -->
			</th>
			<th>#i18n{form.modifyForm.manageEnter.rowActions}&nbsp;
				
			</th>
		</tr>
	</thead>
	<tbody>
	<#list entry_list as entry>
		<tr>
			<td>
			<!--  add checkbox if entry isn't a group --> 
			<#if !entry.entryType.group>
				<input type="checkbox" name="entry_id"value="${entry.idEntry!}" title="#i18n{form.modifyForm.select}" />
			</#if>
			</td>
			<td>
			<#if entry.entryType.group>
				${entry.title}
			<#elseif entry.parent?exists>
				<#if entry.entryType.comment>
					<blockquote>${entry.comment}</blockquote>
				<#else>
					<blockquote>${entry.title}</blockquote>
				</#if>
			<#elseif entry.entryType.myLuteceUser>
					${entry.title}
			<#else>
				<#if entry.entryType.comment>
					${entry.comment}
				<#else>
					${entry.title}
				</#if>
			</#if>
			<#if !entry.entryType.group>
				<span class="badge">${entry.entryType.title}</span>
			</#if>
			</td>
			<td>
				<#if entry.numberConditionalQuestion!=0>
					${entry.numberConditionalQuestion}
				</#if>
			</td>
			<!--  Change the order of the attribute -->
			<#if entry.parent?exists>
			<td>
				<blockquote>
					<@comboOrders name="order_id_${entry.idEntry!}" default_value=entry.position idParent=entry.parent.idEntry />
					<button class="btn btn-primary btn-small" type="submit"	name="move_${entry.idEntry!}" title="#i18n{directory.modify_directory.move}" value="#i18n{directory.modify_directory.move}"><i class="icon-resize-vertical icon-white"></i></button>
				</blockquote>
				</td>
			<#else>
			<td>
				<@comboOrders name="order_id_${entry.idEntry!}"	default_value=entry.position idParent=0 />
				<button class="btn btn-primary btn-small" type="submit" name="move_${entry.idEntry!}" title="#i18n{directory.modify_directory.move}" value="#i18n{directory.modify_directory.move}">
					<i class="icon-ok icon-white"></i>
				</button>
			</td> 
			</#if>
			<td>
			<a href="jsp/admin/plugins/form/ModifyEntry.jsp?id_entry=${entry.idEntry}" class="btn btn-primary btn-small">
				<i class="icon-edit icon-white"></i>
			</a>
			<#if entry.parent?exists>
				<a href="jsp/admin/plugins/form/DoMoveOutEntry.jsp?id_entry=${entry.idEntry}#list" title="#i18n{form.modifyForm.manageEnter.titleGoOut}" class="btn btn-primary btn-small">
					<i class="icon-chevron-right icon-white"></i>
				</a>
			<#elseif !entry.entryType.group && !entry.entryType.myLuteceUser>
				<a href="jsp/admin/plugins/form/MoveEntry.jsp?id_entry=${entry.idEntry}#list" title="#i18n{form.modifyForm.manageEnter.titleMove}" class="btn btn-primary btn-small">
					<i class="icon-user icon-white"></i>
				</a>
			</#if>
			<#if !entry.entryType.group && !entry.entryType.myLuteceUser>
				<a href="jsp/admin/plugins/form/DoCopyEntry.jsp?id_entry=${entry.idEntry}#list" title="#i18n{form.modifyForm.manageEnter.titleCopy}" class="btn btn-primary btn-small">
					<i class="icon-plus-sign icon-white"></i>
				</a>
			</#if>
			<#if !entry.entryType.myLuteceUser>
				<a href="jsp/admin/plugins/form/ConfirmRemoveEntry.jsp?id_entry=${entry.idEntry}#list" title="#i18n{form.modifyForm.manageEnter.titleDelete}" class="btn btn-danger btn-small">
					<i class="icon-trash icon-white"></i>
				</a>
			</#if>
			</td>
			</tr>
			</#list>
		</tbody>
		</table>
		</form>
	<@paginationAdmin paginator=paginator/>
</div>
</div>
<#include "/admin/util/editor/editor.html" />
<#include "/admin/util/calendar/calendar.html" />

<script>
$(document).ready( function () {
	$("#advanced_settings").next().toggle();
	doToggleId( "#advanced_settings" );
	$("#publication_settings").next().toggle();
	doToggleId( "#publication_settings" );
	$("#answers_cleaning_settings").next().toggle();
	doToggleId( "#answers_cleaning_settings" );
});

function doToggleId( idParent ){
	$( idParent ).click( function(){ 
		$(this).next().toggle();
	});
}
</script>

<script type="text/javascript">
function doChangePublicationMode(radio){
		for (var i=0; i<radio.length; i++){
			if (radio[i].checked){
				if (radio[i].value=="0"){
					document.getElementById('date_begin_disponibility').value="";
					document.getElementById('date_end_disponibility').value="";
				} else	{
					document.getElementById('date_begin_disponibility').value=document.getElementById('date_begin_disponibility_save').value;
					document.getElementById('date_end_disponibility').value=document.getElementById('date_end_disponibility_save').value;
				}
			}
		}
	}

	function doChangeDate(radio)
	{
		document.getElementById('date_begin_disponibility_save').value=document.getElementById('date_begin_disponibility').value;
		document.getElementById('date_end_disponibility_save').value=document.getElementById('date_end_disponibility').value;
		
		if (document.getElementById('date_begin_disponibility').value!="" || document.getElementById('date_end_disponibility').value!="")
		{
			radio[0].checked=false;
			radio[1].checked=true;
		}
		else
		{
			radio[0].checked=true;
			radio[1].checked=false;
		}
	}
</script>
<@initEditor />

<script src="js/jquery/plugins/ui/jquery-ui-1.8.16.custom.min.js"></script>
<script src="js/jquery/plugins/ui/ui.datepicker-fr.js"></script>
<@getDatePickerRange idFieldFrom="date_begin_disponibility" idFieldTo="date_end_disponibility" language=locale />

<#macro comboOrders name default_value idParent >
<#if mapChild?exists>
<select id="${name}" name="${name}" class="input-mini"> 
	<#list mapChild[idParent!?string] as i> <#if default_value == i>
		<option selected="selected" value="${i}">${i}</option> <#else>
		<option value="${i}">${i}</option> </#if>
	</#list>
</select>
</#if>
</#macro>
