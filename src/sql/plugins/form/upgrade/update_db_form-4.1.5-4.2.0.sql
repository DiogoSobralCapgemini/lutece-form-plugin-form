SET character_set_client = utf8;

ALTER TABLE form_form ADD COLUMN max_number_response INT default 0;
--
-- Table structure for table list_form_portlet
--
DROP TABLE IF EXISTS form_list_portlet;
CREATE TABLE list_form_portlet (
	id_portlet int default NULL,
	id_category_form int default NULL
);
INSERT INTO core_style (id_style, description_style, id_portlet_type, id_portal_component) VALUES (1501,'Défaut','LIST_FORM_PORTLET',0);
INSERT INTO core_style_mode_stylesheet (id_style, id_mode, id_stylesheet) VALUES (1501,0,9008);
INSERT INTO core_stylesheet (id_stylesheet, description, file_name, source) VALUES (9008,'Rubrique Liste de formulaires - Défaut','portlet_list_form.xsl',0x3c3f786d6c2076657273696f6e3d22312e30223f3e0a3c78736c3a7374796c6573686565742076657273696f6e3d22312e30220a0909786d6c6e733a78736c3d22687474703a2f2f7777772e77332e6f72672f313939392f58534c2f5472616e73666f726d223e0a3c78736c3a6f7574707574206d6574686f643d2268746d6c2220696e64656e743d22796573222f3e0a09093c78736c3a74656d706c617465206d617463683d22706f72746c65742f666f726d2d706f72746c65742f666f726d2d706f72746c65742d636f6e74656e74223e0a090909093c64697620636c6173733d22706f72746c6574202d6c75746563652d626f726465722d72616469757320617070656e642d626f74746f6d223e0a0909090909093c78736c3a666f722d656163682073656c6563743d2263617465676f72792d666f726d223e0a09090909090909093c78736c3a7661726961626c65206e616d653d22636f6c6f72223e3c78736c3a76616c75652d6f662073656c6563743d2263617465676f72792d636f6c6f72222f3e3c2f78736c3a7661726961626c653e0a09090909090909093c64697620636c6173733d2263617465676f727920636f6c6f725f7b24636f6c6f727d223e0a090909090909090909093c64697620636c6173733d2263617465676f72792d7469746c65223e0a0909090909090909090909093c78736c3a76616c75652d6f662073656c6563743d2263617465676f72792d7469746c65222f3e0a090909090909090909093c2f6469763e0a09090909090909093c2f6469763e0a0909090909093c2f78736c3a666f722d656163683e0a0909090909093c756c20636c6173733d226c6973745f666f726d223e0a0909090909093c78736c3a666f722d656163682073656c6563743d22666f726d223e0a09090909090909093c78736c3a7661726961626c65206e616d653d2275726c5f666f726d223e6a73702f736974652f506f7274616c2e6a73703f706167653d666f726d26616d703b69645f666f726d3d3c78736c3a76616c75652d6f662073656c6563743d22666f726d2d6964222f3e3c2f78736c3a7661726961626c653e0a09090909090909093c6c693e3c6120687265663d227b2475726c5f666f726d7d223e3c78736c3a76616c75652d6f662073656c6563743d22666f726d2d7469746c65222f3e3c2f613e3c2f6c693e0a0909090909093c2f78736c3a666f722d656163683e0a090909093c2f756c3e0a090909093c2f6469763e0a09202020203c2f78736c3a74656d706c6174653e0a09093c78736c3a74656d706c617465206d617463683d222f7c2a223e0a090909093c78736c3a6170706c792d74656d706c617465732073656c6563743d22706f72746c65742f666f726d2d706f72746c65742f666f726d2d706f72746c65742d636f6e74656e7422202f3e0a09202020203c2f78736c3a74656d706c6174653e0a3c2f78736c3a7374796c6573686565743e0a);
INSERT INTO core_portlet_type (id_portlet_type,name,url_creation,url_update,home_class,plugin_name,url_docreate,create_script,create_specific,create_specific_form,url_domodify,modify_script,modify_specific,modify_specific_form) VALUES ('LIST_FORM_PORTLET','form.portlet.listForm.name','plugins/form/CreateListFormPortlet.jsp','plugins/form/ModifyListFormPortlet.jsp','fr.paris.lutece.plugins.form.business.portlet.ListFormPortletHome','form','plugins/form/DoCreateListFormPortlet.jsp','','/admin/plugins/form/list_categories.html','','plugins/form/DoModifyListFormPortlet.jsp','','/admin/plugins/form/list_categories.html','');

-- 
-- Update the xsl file of all export_format
-- 
UPDATE form_export_format SET id_export = 1, title = 'csv', description = 'exporter les réponses au format csv',extension = 'csv',xsl_file = 0x3C3F786D6C2076657273696F6E3D22312E302220656E636F64696E673D2249534F2D383835392D31223F3E0D0A3C78736C3A7374796C6573686565742076657273696F6E3D22312E302220786D6C6E733A78736C3D22687474703A2F2F7777772E77332E6F72672F313939392F58534C2F5472616E73666F726D223E0D0A3C78736C3A6F7574707574206D6574686F643D2274657874222F3E0D0A0D0A3C78736C3A74656D706C617465206D617463683D222F223E0D0A093C78736C3A6170706C792D74656D706C617465732073656C6563743D22666F726D2F666F726D2D656E74726965732F666F726D2D656E74727922202F3E0D0A093C78736C3A746578743E262331303B3C2F78736C3A746578743E0D0A093C78736C3A6170706C792D74656D706C617465732073656C6563743D22666F726D2F7375626D6974732F7375626D6974222F3E0D0A3C2F78736C3A74656D706C6174653E0D0A0D0A3C78736C3A74656D706C617465206D617463683D22666F726D2F666F726D2D656E74726965732F666F726D2D656E747279223E0D0A093C78736C3A746578743E223C2F78736C3A746578743E0D0A093C78736C3A76616C75652D6F662073656C6563743D22666F726D2D656E7472792D7469746C6522202F3E200D0A093C78736C3A746578743E223B3C2F78736C3A746578743E0D0A3C2F78736C3A74656D706C6174653E0D0A0D0A3C78736C3A74656D706C617465206D617463683D22666F726D2F7375626D6974732F7375626D6974223E0D0A093C78736C3A7661726961626C65206E616D653D227375626D69742D6964222073656C6563743D227375626D69742D696422202F3E0D0A093C78736C3A666F722D656163682073656C6563743D222E2E2F2E2E2F666F726D2D656E74726965732F666F726D2D656E747279223E0D0A09093C78736C3A7661726961626C65206E616D653D22666F726D2D656E7472792D6964222073656C6563743D22666F726D2D656E7472792D696422202F3E0D0A09093C78736C3A7661726961626C65206E616D653D22666F726D2D656E7472792D697465726174696F6E2D6E756D626572222073656C6563743D22666F726D2D656E7472792D697465726174696F6E2D6E756D62657222202F3E0D0A09093C78736C3A63686F6F73653E0D0A0909093C78736C3A7768656E20746573743D22737472696E67282E2E2F2E2E2F7375626D6974732F7375626D69745B7375626D69742D69643D247375626D69742D69645D2F7175657374696F6E732F7175657374696F6E5B7175657374696F6E2D69643D24666F726D2D656E7472792D69645D5B697465726174696F6E2D6E756D6265723D24666F726D2D656E7472792D697465726174696F6E2D6E756D6265725D29223E0D0A090909093C78736C3A6170706C792D74656D706C617465732073656C6563743D222E2E2F2E2E2F7375626D6974732F7375626D69745B7375626D69742D69643D247375626D69742D69645D2F7175657374696F6E732F7175657374696F6E5B7175657374696F6E2D69643D24666F726D2D656E7472792D69645D5B697465726174696F6E2D6E756D6265723D24666F726D2D656E7472792D697465726174696F6E2D6E756D6265725D222F3E0D0A0909093C2F78736C3A7768656E3E0D0A0909093C78736C3A6F74686572776973653E0D0A090909093C78736C3A746578743E22223B3C2F78736C3A746578743E0D0A0909093C2F78736C3A6F74686572776973653E0D0A09093C2F78736C3A63686F6F73653E0D0A093C2F78736C3A666F722D656163683E0D0A093C78736C3A746578743E262331303B3C2F78736C3A746578743E0D0A3C2F78736C3A74656D706C6174653E0D0A0D0A3C78736C3A74656D706C617465206D617463683D227175657374696F6E732F7175657374696F6E223E0D0A093C78736C3A6170706C792D74656D706C617465732073656C6563743D22726573706F6E736573222F3E200D0A3C2F78736C3A74656D706C6174653E0D0A0D0A3C78736C3A74656D706C617465206D617463683D227175657374696F6E732F7175657374696F6E2F726573706F6E736573223E0D0A093C78736C3A746578743E223C2F78736C3A746578743E0D0A093C78736C3A6170706C792D74656D706C617465732073656C6563743D22726573706F6E7365222F3E0D0A093C78736C3A746578743E223B3C2F78736C3A746578743E0D0A3C2F78736C3A74656D706C6174653E0D0A0D0A3C78736C3A74656D706C617465206D617463683D227175657374696F6E732F7175657374696F6E2F726573706F6E7365732F726573706F6E7365223E0D0A093C78736C3A76616C75652D6F662073656C6563743D222E222F3E0D0A093C78736C3A696620746573743D22706F736974696F6E2829213D6C6173742829223E0D0A09093C78736C3A746578743E3B3C2F78736C3A746578743E0D0A093C2F78736C3A69663E0D0A3C2F78736C3A74656D706C6174653E0D0A0D0A3C2F78736C3A7374796C6573686565743E0D0A WHERE id_export = 1;
UPDATE form_export_format SET id_export = 2, title = 'xml', description = 'exporter les réponses au format xml',extension = 'xml',xsl_file = 0x3C3F786D6C2076657273696F6E3D22312E302220656E636F64696E673D225554462D38223F3E0D0A3C78736C3A7374796C6573686565742076657273696F6E3D22312E302220786D6C6E733A78736C3D22687474703A2F2F7777772E77332E6F72672F313939392F58534C2F5472616E73666F726D223E0D0A3C78736C3A6F7574707574206D6574686F643D22786D6C222076657273696F6E3D22312E302220656E636F64696E673D225554462D382220696E64656E743D22796573222063646174612D73656374696F6E2D656C656D656E74733D22726573706F6E7365207175657374696F6E2D7469746C6520666F726D2D7469746C65222F3E0D0A3C78736C3A74656D706C617465206D617463683D222F223E0D0A203C78736C3A6170706C792D74656D706C617465732073656C6563743D22666F726D222F3E200D0A3C2F78736C3A74656D706C6174653E0D0A0D0A3C78736C3A74656D706C617465206D617463683D22666F726D223E0D0A093C666F726D3E0D0A09093C666F726D2D7469746C653E0D0A0909093C78736C3A76616C75652D6F662073656C6563743D22666F726D2D7469746C65222F3E0D0A09093C2F666F726D2D7469746C653E0D0A09093C7375626D6974733E0D0A0909093C78736C3A6170706C792D74656D706C617465732073656C6563743D227375626D6974732F7375626D6974222F3E200D0A09093C2F7375626D6974733E0D0A093C2F666F726D3E090D0A3C2F78736C3A74656D706C6174653E0D0A0D0A3C78736C3A74656D706C617465206D617463683D227375626D6974223E0D0A093C7375626D69743E0D0A09093C7375626D69742D69643E0D0A0909093C78736C3A76616C75652D6F662073656C6563743D227375626D69742D6964222F3E0D0A09093C2F7375626D69742D69643E0D0A09093C7375626D69742D646174653E0D0A0909093C78736C3A76616C75652D6F662073656C6563743D227375626D69742D64617465222F3E0D0A09093C2F7375626D69742D646174653E0D0A09093C7375626D69742D69703E0D0A0909093C78736C3A76616C75652D6F662073656C6563743D227375626D69742D6970222F3E0D0A09093C2F7375626D69742D69703E0D0A09093C7175657374696F6E733E0D0A0909093C78736C3A6170706C792D74656D706C617465732073656C6563743D227175657374696F6E732F7175657374696F6E222F3E200D0A09093C2F7175657374696F6E733E0D0A093C2F7375626D69743E0D0A3C2F78736C3A74656D706C6174653E0D0A3C78736C3A74656D706C617465206D617463683D227175657374696F6E223E0D0A093C7175657374696F6E3E0D0A09093C7175657374696F6E2D69643E0D0A0909093C78736C3A76616C75652D6F662073656C6563743D227175657374696F6E2D6964222F3E0D0A09093C2F7175657374696F6E2D69643E0D0A09093C697465726174696F6E2D6E756D6265723E0D0A0909093C78736C3A76616C75652D6F662073656C6563743D22697465726174696F6E2D6E756D626572222F3E0D0A09093C2F697465726174696F6E2D6E756D6265723E0D0A09093C7175657374696F6E2D7469746C653E0D0A0909093C78736C3A76616C75652D6F662073656C6563743D227175657374696F6E2D7469746C65222F3E0D0A09093C2F7175657374696F6E2D7469746C653E0D0A09093C726573706F6E7365733E0D0A0909093C78736C3A6170706C792D74656D706C617465732073656C6563743D22726573706F6E7365732F726573706F6E7365222F3E200D0A09093C2F726573706F6E7365733E0D0A093C2F7175657374696F6E3E0D0A3C2F78736C3A74656D706C6174653E0D0A3C78736C3A74656D706C617465206D617463683D22726573706F6E7365223E0D0A093C726573706F6E73653E0D0A09093C78736C3A76616C75652D6F662073656C6563743D222E222F3E0D0A093C2F726573706F6E73653E0D0A3C2F78736C3A74656D706C6174653E0D0A3C2F78736C3A7374796C6573686565743E WHERE id_export = 2;
UPDATE form_export_format SET id_export = 3, title = 'csv_daemon', description = 'exporter les réponses au format csv pour le daemon d''export',extension = 'csv',xsl_file = 0x3C3F786D6C2076657273696F6E3D22312E302220656E636F64696E673D225554462D38223F3E0D0A3C78736C3A7374796C6573686565742076657273696F6E3D22312E302220786D6C6E733A78736C3D22687474703A2F2F7777772E77332E6F72672F313939392F58534C2F5472616E73666F726D223E0D0A3C78736C3A6F7574707574206D6574686F643D2274657874222F3E0D0A0D0A3C78736C3A74656D706C617465206D617463683D222F223E0D0A093C78736C3A6170706C792D74656D706C617465732073656C6563743D22666F726D2F666F726D2D656E74726965732F666F726D2D656E74727922202F3E0D0A093C78736C3A746578743E262331303B3C2F78736C3A746578743E0D0A093C78736C3A6170706C792D74656D706C617465732073656C6563743D22666F726D2F7375626D6974732F7375626D6974222F3E0D0A3C2F78736C3A74656D706C6174653E0D0A0D0A3C78736C3A74656D706C617465206D617463683D22666F726D2F666F726D2D656E74726965732F666F726D2D656E747279223E0D0A093C78736C3A746578743E223C2F78736C3A746578743E0D0A093C78736C3A76616C75652D6F662073656C6563743D22666F726D2D656E7472792D7469746C6522202F3E200D0A093C78736C3A746578743E223B3C2F78736C3A746578743E0D0A3C2F78736C3A74656D706C6174653E0D0A0D0A3C78736C3A74656D706C617465206D617463683D22666F726D2F7375626D6974732F7375626D6974223E0D0A093C78736C3A7661726961626C65206E616D653D227375626D69742D6964222073656C6563743D227375626D69742D696422202F3E0D0A093C78736C3A666F722D656163682073656C6563743D222E2E2F2E2E2F666F726D2D656E74726965732F666F726D2D656E747279223E0D0A09093C78736C3A7661726961626C65206E616D653D22666F726D2D656E7472792D6964222073656C6563743D22666F726D2D656E7472792D696422202F3E0D0A09093C78736C3A7661726961626C65206E616D653D22666F726D2D656E7472792D697465726174696F6E2D6E756D626572222073656C6563743D22666F726D2D656E7472792D697465726174696F6E2D6E756D62657222202F3E0D0A09093C78736C3A63686F6F73653E0D0A0909093C78736C3A7768656E20746573743D22737472696E67282E2E2F2E2E2F7375626D6974732F7375626D69745B7375626D69742D69643D247375626D69742D69645D2F7175657374696F6E732F7175657374696F6E5B7175657374696F6E2D69643D24666F726D2D656E7472792D69645D5B697465726174696F6E2D6E756D6265723D24666F726D2D656E7472792D697465726174696F6E2D6E756D6265725D29223E0D0A090909093C78736C3A6170706C792D74656D706C617465732073656C6563743D222E2E2F2E2E2F7375626D6974732F7375626D69745B7375626D69742D69643D247375626D69742D69645D2F7175657374696F6E732F7175657374696F6E5B7175657374696F6E2D69643D24666F726D2D656E7472792D69645D5B697465726174696F6E2D6E756D6265723D24666F726D2D656E7472792D697465726174696F6E2D6E756D6265725D222F3E0D0A0909093C2F78736C3A7768656E3E0D0A0909093C78736C3A6F74686572776973653E0D0A090909093C78736C3A746578743E22223B3C2F78736C3A746578743E0D0A0909093C2F78736C3A6F74686572776973653E0D0A09093C2F78736C3A63686F6F73653E0D0A093C2F78736C3A666F722D656163683E0D0A093C78736C3A746578743E262331303B3C2F78736C3A746578743E0D0A3C2F78736C3A74656D706C6174653E0D0A0D0A3C78736C3A74656D706C617465206D617463683D227175657374696F6E732F7175657374696F6E223E0D0A093C78736C3A6170706C792D74656D706C617465732073656C6563743D22726573706F6E736573222F3E200D0A3C2F78736C3A74656D706C6174653E0D0A0D0A3C78736C3A74656D706C617465206D617463683D227175657374696F6E732F7175657374696F6E2F726573706F6E736573223E0D0A093C78736C3A746578743E223C2F78736C3A746578743E0D0A093C78736C3A6170706C792D74656D706C617465732073656C6563743D22726573706F6E7365222F3E0D0A093C78736C3A746578743E223B3C2F78736C3A746578743E0D0A3C2F78736C3A74656D706C6174653E0D0A0D0A3C78736C3A74656D706C617465206D617463683D227175657374696F6E732F7175657374696F6E2F726573706F6E7365732F726573706F6E7365223E0D0A093C78736C3A76616C75652D6F662073656C6563743D222E222F3E0D0A093C78736C3A696620746573743D22706F736974696F6E2829213D6C6173742829223E0D0A09093C78736C3A746578743E3B3C2F78736C3A746578743E0D0A093C2F78736C3A69663E0D0A3C2F78736C3A74656D706C6174653E0D0A0D0A3C2F78736C3A7374796C6573686565743E0D0A WHERE id_export = 3;
UPDATE form_export_format SET id_export = 4, title = 'xml_daemon', description = 'exporter les réponses au format XML pour le daemon d''export',extension = 'xml',xsl_file = 0x3C3F786D6C2076657273696F6E3D22312E302220656E636F64696E673D225554462D38223F3E0D0A3C78736C3A7374796C6573686565742076657273696F6E3D22312E302220786D6C6E733A78736C3D22687474703A2F2F7777772E77332E6F72672F313939392F58534C2F5472616E73666F726D223E0D0A3C78736C3A6F7574707574206D6574686F643D22786D6C222076657273696F6E3D22312E302220656E636F64696E673D225554462D382220696E64656E743D22796573222063646174612D73656374696F6E2D656C656D656E74733D22726573706F6E7365207175657374696F6E2D7469746C6520666F726D2D7469746C65222F3E0D0A3C78736C3A74656D706C617465206D617463683D222F223E0D0A203C78736C3A6170706C792D74656D706C617465732073656C6563743D22666F726D222F3E200D0A3C2F78736C3A74656D706C6174653E0D0A0D0A3C78736C3A74656D706C617465206D617463683D22666F726D223E0D0A093C666F726D3E0D0A09093C666F726D2D7469746C653E0D0A0909093C78736C3A76616C75652D6F662073656C6563743D22666F726D2D7469746C65222F3E0D0A09093C2F666F726D2D7469746C653E0D0A09093C7375626D6974733E0D0A0909093C78736C3A6170706C792D74656D706C617465732073656C6563743D227375626D6974732F7375626D6974222F3E200D0A09093C2F7375626D6974733E0D0A093C2F666F726D3E090D0A3C2F78736C3A74656D706C6174653E0D0A0D0A3C78736C3A74656D706C617465206D617463683D227375626D6974223E0D0A093C7375626D69743E0D0A09093C7375626D69742D69643E0D0A0909093C78736C3A76616C75652D6F662073656C6563743D227375626D69742D6964222F3E0D0A09093C2F7375626D69742D69643E0D0A09093C7375626D69742D646174653E0D0A0909093C78736C3A76616C75652D6F662073656C6563743D227375626D69742D64617465222F3E0D0A09093C2F7375626D69742D646174653E0D0A09093C7375626D69742D69703E0D0A0909093C78736C3A76616C75652D6F662073656C6563743D227375626D69742D6970222F3E0D0A09093C2F7375626D69742D69703E0D0A09093C7175657374696F6E733E0D0A0909093C78736C3A6170706C792D74656D706C617465732073656C6563743D227175657374696F6E732F7175657374696F6E222F3E200D0A09093C2F7175657374696F6E733E0D0A093C2F7375626D69743E0D0A3C2F78736C3A74656D706C6174653E0D0A3C78736C3A74656D706C617465206D617463683D227175657374696F6E223E0D0A093C7175657374696F6E3E0D0A09093C7175657374696F6E2D69643E0D0A0909093C78736C3A76616C75652D6F662073656C6563743D227175657374696F6E2D6964222F3E0D0A09093C2F7175657374696F6E2D69643E0D0A09093C697465726174696F6E2D6E756D6265723E0D0A0909093C78736C3A76616C75652D6F662073656C6563743D22697465726174696F6E2D6E756D626572222F3E0D0A09093C2F697465726174696F6E2D6E756D6265723E0D0A09093C7175657374696F6E2D7469746C653E0D0A0909093C78736C3A76616C75652D6F662073656C6563743D227175657374696F6E2D7469746C65222F3E0D0A09093C2F7175657374696F6E2D7469746C653E0D0A09093C726573706F6E7365733E0D0A0909093C78736C3A6170706C792D74656D706C617465732073656C6563743D22726573706F6E7365732F726573706F6E7365222F3E200D0A09093C2F726573706F6E7365733E0D0A093C2F7175657374696F6E3E0D0A3C2F78736C3A74656D706C6174653E0D0A3C78736C3A74656D706C617465206D617463683D22726573706F6E7365223E0D0A093C726573706F6E73653E0D0A09093C78736C3A76616C75652D6F662073656C6563743D222E222F3E0D0A093C2F726573706F6E73653E0D0A3C2F78736C3A74656D706C6174653E0D0A3C2F78736C3A7374796C6573686565743E WHERE id_export = 4;

-- 
-- Add a column for the id of the file for the front office picture of a form
-- 
ALTER TABLE form_form ADD COLUMN is_shown_front_office_picture SMALLINT default 0;
ALTER TABLE form_form ADD COLUMN id_file_front_office_picture INT default 0;

-- 
-- Add value for the max size of front office picture uploaded
-- 
INSERT INTO form_form_parameter (parameter_key, parameter_value) VALUES ( 'front_office_picture_max_size', '2097152');

